% plot the netcharge vs time of isolation in 4 subfigures
% Feb 4, 2013
% Hsiang-Yu Yuan

ranges = [1993.601 1994.6; 
          1994.601 1995.6;
          1995.601 1996.6; 
          1996.601 1997.6;
          1997.601 1998.6; 
          1998.601 1999.6;
          1999.601 2000.6; 
          2000.601 2001.6;
          2001.601 2002.6;
          2002.601 2003.6; 
          2003.601 2004.6;
          2004.601 2005.6; 
          2005.601 2006.6;
          ]
ranges2 = [1993.601 2006.6];      
ranges = ranges2;      
load('../dat/h3n2_ny/hm_h3n2_ny_merged_data.mat');
figure;
hold;


%TF = find(Viruses(:,2)>ranges(ageid,1) & Viruses(:,2)<ranges(ageid,2) &  Viruses(:,1)~=0);
year_s = ranges2(1,1);
year_e = ranges2(1,2);

TF = find(Viruses(:,2)>year_s & Viruses(:,2)<year_e &  Viruses(:,1)~=0);
%plot(Viruses(TF,2),Viruses(TF,3),'.-'); %NetCharge vs Date
viruses = Viruses(TF,:);

ngs_index = 4;
index = 2; %isolation date
charge_index = 3; %netcharge

    ngs=0;
    for yid=1:length(ranges(:,1))
    y_s = ranges(yid,1);
    y_e = ranges(yid,2);
    viruses_ngs = viruses(find(viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);

    
    % Viral Strains with no #NGS constraints
    
    
    % Viral Strains with #NGS = 7
    ngs=7;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    %plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ro');
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):1:max(x);
    YFIT = b(1) + b(2)*x1fit;
    %subplot(4,1,1);
    %plot(x1fit,YFIT,'R-');
    stats(2:3)
    
    % Viral Strains with #NGS = 8
    subplot(2,2,1);
    hold;
    ngs=8;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Go');
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):0.1:max(x)+0.1;
    YFIT = b(1) + b(2)*x1fit;
    plot(x1fit,YFIT,'G-');
    stats(2:3)
    set(gca,'XLim',[1993.5 2006.5]) %set the range
    set(gca,'YLim',[14 20]) %set the domain
    title(['NGS=8']);
    
    % Viral Strains with #NGS = 9
    subplot(2,2,2);
    hold;
    ngs=9;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Bo');
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):0.1:max(x)+0.1;
    YFIT = b(1) + b(2)*x1fit;
    plot(x1fit,YFIT,'B-');
    stats(2:3)
    set(gca,'XLim',[1993.5 2006.5]) %set the range
    set(gca,'YLim',[14 20]) %set the domain
    title(['NGS=9']);
    
    % Viral Strains with #NGS = 10
    subplot(2,2,3);
    hold;
    ngs=10;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Co');
    %p = polyfit(x,y,1);
    %f = polyval(p,x1);
    %plot(x1, f, 'C-');
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):0.1:max(x)+0.1;
    YFIT = b(1) + b(2)*x1fit;
    plot(x1fit,YFIT,'C-');
    stats(2:3)
    set(gca,'XLim',[1993.5 2006.5]) %set the range
    set(gca,'YLim',[14 20]) %set the domain
    title(['NGS=10']);
    
    % Viral Strains with #NGS = 11
    subplot(2,2,4);
    hold;
    ngs=11;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ko');
    %if(length(viruses_ngs(:,1))>10)
    %p = polyfit(x,y,1);
    %f = polyval(p,x1);
    %plot(x1, f, 'K-');
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):0.1:max(x)+0.1;
    YFIT = b(1) + b(2)*x1fit;
    plot(x1fit,YFIT,'K-');
    stats(2:3)
    set(gca,'XLim',[1993.5 2006.5]) %set the range
    set(gca,'YLim',[14 20]) %set the domain
    title(['NGS=11']);
    % Viral Strains with #NGS = 12
    ngs=12;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    %plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Yo');
    
    %if(length(viruses_ngs(:,1))>10)
    %    p = polyfit(x,y,1);
    %    f = polyval(p,x1);
    %    plot(x1, f, 'Y-');
    %end
    X = [ones(size(x)) x]; 
    [b,bint,r,rint,stats] = regress(y,X);
    x1fit = min(x):1:max(x)+1;
    YFIT = b(1) + b(2)*x1fit;
    %plot(x1fit,YFIT,'Y-');
    stats(2:3)
    
    
    %viruses_ngs = viruses(find(viruses(:,ngs_index)==7 | viruses(:,ngs_index)==8 | viruses(:,ngs_index)==9 | viruses(:,ngs_index)==10 | viruses(:,ngs_index)==11 & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    %x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    %x = viruses_ngs(:,index);
    %y = viruses_ngs(:,charge_index);
    
    %X = [ones(size(x)) x]; 
    %[b,bint,r,rint,stats] = regress(y,X);
    %x1fit = min(x):1:max(x);
    %YFIT = b(1) + b(2)*x1fit;
    %plot(x1fit,YFIT,'B-');
    %stats(2:3)
    
    end
    
    
    %for v=1:length(viruses(:,1))
    %    if viruses(v,ngs_index)==7
    %        plot(viruses(v,index), viruses(v,3) , 'Ro');
    %    elseif viruses(v,ngs_index)==8
    %        plot(viruses(v,index), viruses(v,3) , 'Go');
    %    elseif viruses(v,ngs_index)==9
    %        plot(viruses(v,index), viruses(v,3) , 'Bo');
    %    elseif viruses(v,ngs_index)==10
    %        plot(viruses(v,index), viruses(v,3) , 'Co');
    %    elseif viruses(v,ngs_index)==11
    %        plot(viruses(v,index), viruses(v,3) , 'Ko');
    %    elseif viruses(v,ngs_index)==12
    %        plot(viruses(v,index), viruses(v,3) , 'Yo');
    %    end
    %end
    
    
%axis([ 0, 0, 14, 20])
%set(gca,'XLim',[1993.5 2006.5])
%set(gca,'YLim',[12 21]) %set the range
%x_scale = [1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006];
%x_label = ['1993/1994'; '1994/1995'; '1995/1996'; '1996/1997'; '1997/1998'; '1998/1999'; '1999/2000'; '2000/2001'; '2001/2002'; '2002/2003'; '2003/2004'; '2004/2005'; '2005/2006'];
%set(gca,'XTick',x_scale);
%set(gca,'XTickLabel',x_label);
%xlabel('Time of Isolation');
%ylabel('Netcharges');
%title(['Netcharges vs Time of Isolation (' num2str(fix(ranges2(1,1))) '-' num2str(fix(ranges2(1,2))) ')']);

