% plot the netcharge vs ages
ranges_h3n2_nz = [
          1999 1999.999; 
          2000 2000.999;
          2001 2001.999;
          2002 2002.999; 
          2003 2003.999;
          2004 2004.999; 
          2005 2005.999;
          ]
ranges2_h3n2_nz = [1999 2005.999];      

load('dat/h3n2_nz/hm_h3n2_nz_merged_data.mat');
figure;
i = 1;

for i=1:length(ranges_h3n2_nz(:,1))
    ranges2 = ranges_h3n2_nz(i,:);
    ngs_index = 4;
    charge_index = 3;
    index = 1; %1)age, 2)isolation date
    ageid = 1;
    % #NGS=8
    TF = find(Viruses(:,2)>ranges2(1,1) & Viruses(:,2)<ranges2(1,2) &  Viruses(:,1)~=0);
    viruses = Viruses(TF,:);
    if i==1
        subplot(2,4,1);
        hold;
    elseif i==2
        subplot(2,4,2);
        hold;
    elseif i==3
        subplot(2,4,3);
        hold;
    elseif i==4
        subplot(2,4,4);
        hold;
    elseif i==5
        subplot(2,4,5);
        hold;
    elseif i==6
        subplot(2,4,6);
        hold;
    elseif i==7
        subplot(2,4,7);
        hold;
    elseif i==8
        subplot(2,4,8);
        hold;
    elseif i==9
        subplot(3,4,9);
        hold;
    end
    
    % Viral Strains with #NGS = 7
    x1 = [0:1:100]
    viruses_ngs = viruses(find(viruses(:,ngs_index)==7 & viruses(:,ageid)<=70),:);
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ro');
    if(length(viruses_ngs(:,1))>3)
        %p = polyfit(x,y,1);   % p returns 2 coefficients fitting r = p(1) * x + p(2)
        %f = p(1) .* x1 + p(2); % compute a vector r matching datapoints in x
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'R-');
    end
    
    % Viral Strains with #NGS = 8
    viruses_ngs = viruses(find(viruses(:,ngs_index)==8 & viruses(:,ageid)<=70),:);
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Go');
    if(length(viruses_ngs(:,1))>3)
        %p = polyfit(x,y,1);
        %r = p(1) .* x1 + p(2);
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'G-');
    end
    
    % Viral Strains with #NGS = 9
    viruses_ngs = viruses(find(viruses(:,ngs_index)==9 & viruses(:,ageid)<=70),:);
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Bo');
    if(length(viruses_ngs(:,1))>3)
        %p = polyfit(x,y,1);
        %r = p(1) .* x1 + p(2);
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'B-');
    end
    
        % Viral Strains with #NGS = 10
    viruses_ngs = viruses(find(viruses(:,ngs_index)==10 & viruses(:,ageid)<=70),:);
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Co');
    if(length(viruses_ngs(:,1))>3)
        %p = polyfit(x,y,1);
        %r = p(1) .* x1 + p(2);
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'C-');
    end
    
    % Viral Strains with #NGS = 11
    viruses_ngs = viruses(find(viruses(:,ngs_index)==11 & viruses(:,ageid)<=70),:);
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ko');
    if(length(viruses_ngs(:,1))>3)
        %p = polyfit(x,y,1);
        %r = p(1) .* x1 + p(2);
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'K-');
    end
 
    
    % Total viral strains
    viruses_ngs = viruses;
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    if(length(viruses_ngs(:,1))>10)
        %p = polyfit(x,y,1);
        %r = p(1) .* x1 + p(2);
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'M:');
    end
    
    %for v=1:length(viruses(:,1))
    %    if viruses(v,ngs_index)==7
    %        plot(viruses(v,index), viruses(v,3) , 'Ro');
    %    elseif viruses(v,ngs_index)==8
    %        plot(viruses(v,index), viruses(v,3) , 'Go');
    %    elseif viruses(v,ngs_index)==9
    %        plot(viruses(v,index), viruses(v,3) , 'Bo');
    %    elseif viruses(v,ngs_index)==10
    %        plot(viruses(v,index), viruses(v,3) , 'Co');
    %    elseif viruses(v,ngs_index)==11
    %        plot(viruses(v,index), viruses(v,3) , 'Ko');
    %    elseif viruses(v,ngs_index)==12
    %        plot(viruses(v,index), viruses(v,3) , 'Yo');
    %    end
    %end

%axis([ 0, 0, 14, 20])
set(gca,'XLim',[0 70])
set(gca,'YLim',[10 20]) %set the range
%x_scale = [1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006];
%x_label = ['1995/1996'; '1996/1997'; '1997/1998'; '1998/1999'; '1999/2000'; '2000/2001'; '2001/2002'; '2002/2003'; '2003/2004'; '2004/2005'; '2005/2006'];
%set(gca,'XTick',x_scale);
%set(gca,'XTickLabel',x_label);
title([num2str(fix(ranges2(ageid,1))) '/' num2str(fix(ranges2(ageid,2)))]);

end