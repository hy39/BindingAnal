% plot_h3n2_noram.m
% plot the netcharge by time of isolation
% Data: AH3N2 North America 1968-2012
% Feb 3, 2012
% Hsiang-Yu Yuan




load('../dat/h3n2_noram_1968_2012/hm_h3n2_noram_merged_data_1968.mat');
figure;
%hold;



viruses = Viruses;

ngs_index = 4;
iso_index = 2; %isolation date
charge_index = 3; %netcharge
bding_index = 9; %predicted binding score
    

%iso_index = 1; %isolation date
%ngs_index = 2; %#ngs
%charge_index = 3; %netcharge

year_s = 1967;
year_e = 1998;
y_s = year_s;
y_e = year_e;
    
    
    
    % Viral Strains with #NGS = 6
    viruses_ngs = viruses(find(viruses(:,2)>y_s & viruses(:,2)<y_e-0.5),:);
    %x = round(viruses_ngs(:,index));
    %y = viruses_ngs(:,bding_index);
    %plot(x,y,'Bo');
    %hold;
    
    
    % Viral Strains with #NGS = 8
    ngs=6;
    subplot(3,1,1);
    hold;
    ac = viruses_ngs(find(viruses_ngs(:,ngs_index)==ngs & viruses_ngs(:,iso_index)>y_s & viruses_ngs(:,iso_index)<y_e),:);
    x = round(ac(:,iso_index));
    y = ac(:,bding_index);
    xmin = min(x);
    yavg = mean(y(find(x==xmin)));
    plot(x,y-yavg,'Mo');
    %hold;
    set(gca,'XLim',[year_s year_e]);
    set(gca,'YLim',[-5 15]) %set the range
    ylabel('Predicted Binding Change (\DeltaE)');
    title('#NGS=6');
    
    
    % Viral Strains with #NGS = 9
    ngs=7;
    subplot(3,1,2);
    hold;
    ac = viruses_ngs(find(viruses_ngs(:,ngs_index)==ngs & viruses_ngs(:,iso_index)>y_s & viruses_ngs(:,iso_index)<y_e),:);
    x = round(ac(:,iso_index));
    y = ac(:,bding_index);
    xmin = min(x);
    yavg = mean(y(find(x==xmin)));
    plot(x,y-yavg,'Ro');
    set(gca,'XLim',[year_s year_e]);
    set(gca,'YLim',[-5 15]) %set the range
    ylabel('Predicted Binding Change (\DeltaE)');
    title('#NGS=7');
    
    
    % Viral Strains with #NGS = 10
    ngs=8;
    subplot(3,1,3);
    hold;
    ac = viruses_ngs(find(viruses_ngs(:,ngs_index)==ngs & viruses_ngs(:,iso_index)>y_s & viruses_ngs(:,iso_index)<y_e),:);
    x = round(ac(:,iso_index));
    y = ac(:,bding_index);
    xmin = min(x);
    yavg = mean(y(find(x==xmin)));
    plot(x,y-yavg,'Go');
    set(gca,'XLim',[year_s year_e]);
    set(gca,'YLim',[-5 15]) %set the range
    ylabel('Predicted Binding Change (\DeltaE)');
    title('#NGS=8');
    

    
    
    
%axis([ 0, 0, 14, 20])
%year_s = 1968;
%year_e = 2010;
%set(gca,'XLim',[year_s year_e])
%set(gca,'YLim',[10 21]) %set the range
%x_scale = [1998 1999 2000 2001 2002 2003 2004 2005 2006];
%x_label = ['1997/1998'; '1998/1999'; '1999/2000'; '2000/2001'; '2001/2002'; '2002/2003'; '2003/2004'; '2004/2005'; '2005/2006'];
%x_label = [1998 1999 2000 2001 2002 2003 2004 2005 2006];
%set(gca,'XTick',x_scale);
%set(gca,'XTickLabel',x_label);
%xlabel('Time of Isolation');
%ylabel('Netcharges');
%title(['A/H3N2 (#NGS<9)']);

