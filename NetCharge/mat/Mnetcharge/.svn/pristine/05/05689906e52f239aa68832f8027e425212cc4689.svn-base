% plot the netcharge vs time of isolation
% Sep 11, 2012
% Hsiang-Yu Yuan

ranges_h3n2_sea = [
          1993.601 1994.6; 
          1994.601 1995.6;
          1995.601 1996.6; 
          1996.601 1997.6;
          1997.601 1998.6; 
          1998.601 1999.6;
          1999.601 2000.6; 
          2000.601 2001.6;
          2001.601 2002.6;
          2002.601 2003.6; 
          2003.601 2004.6;
          2004.601 2005.6; 
          2005.601 2006.6;
          ]
ranges2_h3n2_sea = [1993.601 2006.6];      
      

ranges_h3n2_nz = [
          1999 1999.999; 
          2000 2000.999;
          2001 2001.999;
          2002 2002.999; 
          2003 2003.999;
          2004 2004.999; 
          2005 2005.999;
          ]
ranges2_h3n2_nz = [1999 2005.999];      

ranges = ranges_h3n2_sea;
ranges2 = ranges2_h3n2_sea;
%ranges = ranges_h3n2_nz;
%ranges2 = ranges2_h3n2_nz;
load('dat/h3n2_sea/hm_h3n2_sea_merged_data.mat');
figure;
hold;


%TF = find(Viruses(:,2)>ranges(ageid,1) & Viruses(:,2)<ranges(ageid,2) &  Viruses(:,1)~=0);
year_s = ranges2(1,1);
year_e = ranges2(1,2);

%TF = find(Viruses(:,2)>year_s & Viruses(:,2)<year_e &  Viruses(:,1)~=0); % with age information
TF = find(Viruses(:,2)>year_s & Viruses(:,2)<year_e); % no age information
%plot(Viruses(TF,2),Viruses(TF,3),'.-'); %NetCharge vs Date
viruses = Viruses(TF,:);

ngs_index = 4;
index = 2; %isolation date
charge_index = 3; %netcharge

    ngs=0;
    for yid=1:length(ranges(:,1))
    y_s = ranges(yid,1);
    y_e = ranges(yid,2);
    viruses_ngs = viruses(find(viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'M:');
    end
    
    % Viral Strains with no #NGS constraints
    
    
    % Viral Strains with #NGS = 7
    ngs=7;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ro');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'R-');
    end
    
    % Viral Strains with #NGS = 8
    ngs=8;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Go');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'G-');
    end
    
    % Viral Strains with #NGS = 9
    ngs=9;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Bo');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'B-');
    end
    
    % Viral Strains with #NGS = 10
    ngs=10;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Co');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'C-');
    end
    % Viral Strains with #NGS = 11
    ngs=11;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Ko');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'K-');
    end
    % Viral Strains with #NGS = 12
    ngs=12;
    viruses_ngs = viruses(find(viruses(:,ngs_index)==ngs & viruses(:,2)>y_s & viruses(:,2)<y_e),:);
    x1 = [min(viruses_ngs(:,2))-0.1:0.01:max(viruses_ngs(:,2))+0.1];
    x = viruses_ngs(:,index);
    y = viruses_ngs(:,charge_index);
    plot(viruses_ngs(:,index), viruses_ngs(:,3) , 'Yo');
    if(length(viruses_ngs(:,1))>10)
        p = polyfit(x,y,1);
        f = polyval(p,x1);
        plot(x1, f, 'O-');
    end
    end
    
    
    %for v=1:length(viruses(:,1))
    %    if viruses(v,ngs_index)==7
    %        plot(viruses(v,index), viruses(v,3) , 'Ro');
    %    elseif viruses(v,ngs_index)==8
    %        plot(viruses(v,index), viruses(v,3) , 'Go');
    %    elseif viruses(v,ngs_index)==9
    %        plot(viruses(v,index), viruses(v,3) , 'Bo');
    %    elseif viruses(v,ngs_index)==10
    %        plot(viruses(v,index), viruses(v,3) , 'Co');
    %    elseif viruses(v,ngs_index)==11
    %        plot(viruses(v,index), viruses(v,3) , 'Ko');
    %    elseif viruses(v,ngs_index)==12
    %        plot(viruses(v,index), viruses(v,3) , 'Yo');
    %    end
    %end
    
    
%axis([ 0, 0, 14, 20])
set(gca,'XLim',[year_s year_e])
set(gca,'YLim',[12 20]) %set the range
x_scale = [1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006];
x_label = ['1993/1994'; '1994/1995'; '1995/1996'; '1996/1997'; '1997/1998'; '1998/1999'; '1999/2000'; '2000/2001'; '2001/2002'; '2002/2003'; '2003/2004'; '2004/2005'; '2005/2006'];
%x_label = [1998 1999 2000 2001 2002 2003 2004 2005 2006];
set(gca,'XTick',x_scale);
set(gca,'XTickLabel',x_label);
xlabel('Time of Isolation');
ylabel('Netcharges');
title(['Netcharges vs Time of Isolation (' num2str(fix(ranges2(1,1))) '-' num2str(fix(ranges2(1,2))) ')']);

